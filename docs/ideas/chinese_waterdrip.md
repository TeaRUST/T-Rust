# 没有什么比游戏更加适合学习的了

有一个成语叫做"寓教于乐". 最高境界的教育也就无非如此,让参与学习的人不知不觉的在游戏娱乐中学习到了知识. 我记得我最初学习到基本的金融投资知识不是上网课,而是从一个叫做Monopoly的board game学的.这个桌游的中文译名叫做"大富翁". 我相信很多人都玩过. 主人公叫做阿土仔. 那时候我还在中国, 正好赶上从计划经济向市场经济转型的时期. 来自资本主义世界的很多新鲜名词如果只看字典的定义, 肯定不会明白其真正的含义和用途. 但是只要玩过几圈大富翁, 基本上就明白了. 尤其是先破产几次之后.

同样道理, 我们现在也正在面临着一个 Web2到Web3的转型期. 这个转型与其说是一个技术转型不如说是一个经济学和社会管理学的转型. 最早是基于区块链上不可篡改无法人为终止基于共识的去中心化商业逻辑, 逐步从纯记账的金融学领域过渡到组织管理(比如DAO), 最终会不会发展成为颠覆现有人类社会组织形态都很难说. 为了可以深入理解这一切, 同样, 没有比用一个游戏来模拟更佳的选择了. 如果看过\<\<三体>>的同学们都知道, 小说中的三体地球组织就是使用一个叫做三体的游戏来培养信徒和组织成员的. 尽管这个并不是我们设计 TEA Project的初衷, 但是的确有不少人参与了之后表示像是在玩一个游戏.

在深入游戏这个话题之前, 我们还是需要有一些思维热身. 最重要的一个概念叫做第一性原则

# 第一性原则

人们经常引用亨利福特的一句话:"你问你的顾客需要什么, 他不会说需要汽车, 他们会说他们需要一匹跑得更快的马". 如果从第一性原则出发, 你会发现其实很多被各种表象覆盖的根源是十分简单和基本的. 比如有人说比特币不是钱, 因为它不是银行发的. 这就是一个典型忽视第一性原则的思维定势. 钱的定义应该是资产交换的媒介, 至于是不是银行印的纸, 是不是美联储发布的一串数字, 或者金子, 古时候的贝壳, 还有某个小岛上公认标记了所有权的石头. 这些都不重要. 关键是参与交易的人都认同这种标志财富的媒介就可以了. 这个例子中第一性原则就是共识机制. 

自从区块链诞生以来, 这类对以往认知的颠覆就一而再再而三的刷新我对第一性原则的认识. 除了比特币, Uniswap代表的Defi就是另外一个颠覆. 以前的认知是交易是需要在买卖双方进行的. 但是Uniswap认为不一定. 只要有一个公共认同的不可修改的规则(智能合约),就可以进行交易. 在NFT流行之前, 以往认知都感觉只有可以摆在展厅里面的实物艺术品才算是收藏, 后来NFT也改变了这个概念. DAO出现之前, 任何可以运营的经济体都是需要一个实体依托. 往往是公司或者NPO的形态出现. 往往会有一个老板或者CEO,一套组织结构, 法人代码证之类的. 现在正在活跃的成千上万个DAO就严重挑战了这个概念. 这些严格意义上的乌合之众, 多数都是未曾谋面的分散在地球各个角落的digital nomads, 居然可以通过DAO这种虚无的组织形式高效低成本的组织起来. 瞬间把刚刚热了没几天的Web2时代的O2O给搞出危机感了.

这一切都是来源于第一性原则的思维. 简单描述: 这件事儿的根本需求是什么? 现在的方式是不是解决这个需求的最佳方式? 抛弃现有的模式是不是有更好的解决方案? 支持这种新的方案的技术基础是否已经存在? 如果是, 二话别说, 干就是了!

# 设计一个经济学'小岛'游戏

如果你对经济学有点兴趣，很可能看过或者至少听说过《小岛经济学》这本书。实际上设计一个代币经济学系统基本上就等同于设计一个经济学上的小岛。设计这个小岛就类似于设计一个RPG类型的游戏。作为设计者你需要设定游戏规则。这个规则必须是要合理，公平和可持续性，更重要，好玩。如果增加一些开启心智的教育元素就再好不过了。好吧，看看TEA project怎么设计的。

我们可以绕过所有的技术细节，只关注经济和游戏设计领域。TEA里面的玩家有这么几种：茶农（有时为了和其他区块链的叫法一直，我们有时候也叫他们矿工），开发者，投资者，消费者。最最基本的背景假设是这样的：

1. 茶树是茶农用来挣钱的机器。茶树上可以host 开发者设计的软件app。消费者在茶树上使用这些app需要支付茶叶作为货币。这样茶农就挣到了茶叶作为收入。这个过程叫做采茶。茶树不会从空气中产生，茶农需要支付茶叶从社区物业购买种子。茶树会生长变老，随着年龄变化产量（产茶能力）逐步增加到中年后逐步减少，最后死亡。所以茶树种子需要持续购买来维持盈利。
1. 社区物业使用一种智能合约的方式计算向市场上供应多少数量和什么类型的种子。 这个计算原则是根据市场供需平衡来设计的。不能人为干预。
1. 消费者使用软件app的时候一方面支付给茶树gas费用，另一方面软件自己也可以有付费功能in-app purchase直接给开发者。
1. 每一颗茶树，每一个app都是一个可以投资的商业实体，类似于一个公司。茶农或者开发者可以选择发售股票。投资者可以投资这些股票并获得红利。
1. 社区物业为整个社区提供基础服务。包括上面提到过的产生茶树种子，为社区公共账本进行记账，执行社区公约，对于违约者惩罚。这些服务不是免费的。使用这些服务都需要缴费。比如在社区公共账本上占几篇页面存自己app的账务，就需要交这几篇纸的占用费。我们叫做记忆税Memory Tax。如果让社区物业会计帮记账和算账，要交交易费。因为社区物业有一种极高的可信程度，放在这里的数据别人才会相信。所以所有茶农和开发者消费者等等都把账本交给他们管理。
1. 社区物业经理是一个有限数量的工作岗位。所有缴费都是交给他们的小金库里面。这样岂不是他们成了特权阶层，鱼肉乡里了？不会的。他们的从业资格是一个叫做席位的NFT。这个席位是根据哈伯格税的商业逻辑掌控。简单滴说，每个物业经理根据自己对自己的席位的估值按照固定比例交税给社区公共基金。只要有任何一个社区成员愿意出价超过社区经理自己的估价，这个席位就自动转让给了这个买家。于是这个买家就成了新的社区经理，原来的社区经理就混同一般群众了。这样的结果造成了社区经理只能对席位做出一个合理的估值既不会亏本交税也不会被别人垂涎这个席位而夺走。
1. 社区公共基金完全分配给公用事业和所有参加的茶农。分配的原则和参数可以通过社区大会DAO投票来修改。使用智能合约方式自动执行。
1. 整个农场社区的治安是所有茶农共同维护。每个茶农都必须执行巡逻任务。这个任务也是有偿的，由社区公共基金的公共事业部分支出。对于任何一个茶农，这个属于基本收入。
1. 所有茶叶既不会凭空产生也不会自动销毁。除了少部分初始的茶叶分配给了TEA Project的开发团队和早期投资者测试者之外。大部分都保留在社区公共基金用来支付公共事务开销。

看起来很复杂，对吗？但是真正运行起来可比大富翁还要简单。尤其是你理解这样设计的目的之后。仔细理解刚才这些规则，你就会发现这里没有超级权利的人或者集团。貌似权利最大的社区经理实际上是一个流水席。任何时候只有有人肯出更高的价格叫更高的税就可以立马轰走下台。看似地位卑微的茶农从一开始，当茶树还是小苗的时候也至少有一个社区巡逻的活儿可以干，挣点基本生活费。对于既不会种茶树，也没有足够的资金抢夺社区经理位置的普通投资者则可以通过选择和购买购票获得红利。当然投资有风险，万一投资给了FTX就惨了。掌握了这些基本原则就可以在游戏中存活了，那么如果要想发财，在leaderboard排行榜中列席应该怎么做呢？

TEA Project中一个重要的经济学概念叫做bonding curve。上述提到每一个茶树每一个app都可以被设定称为一个投资标的。这个投资标的就有可能是一个bonding curve控制的token。对于这类token的一个重要特点就是币价和总供应量成正相关。也就是说越早期参与而且判定未来会参与人越来越多，收益就会更多。所以比较早的参与和准确的未来发展预期就成为投资的重要选择因素。

和其他所有经济体一样，开发者需要开发出吸引用户的app，茶农需要有耐心等茶树长大，并认真负责维护茶树，也就是计算节点的在线服务，从而获得更好的信用值。不要作恶，否则会引起很严重的处罚。不仅自身损失也连带的投资者。

作为一个长期运行的经济体，设计时候必须仔细考虑的就是可持续性。有大量的区块链相关的项目都是短命的，很多都是资金盘冲起来割一把走人的那种。TEA Project从一开始就坚决和此类项目划清界限。为了设计一个可持续化的项目就必须平衡早起参与者和新加入的社区成员的利益关系。如果太倾向于老玩家，那么新玩家就不会参与，老玩家内卷而终。如果对老玩家没有利益倾向，社区就留不住人，变成铁打营盘流水的兵，从而无法积累和成长。基于这个原因，我们有很多拟生设计。比如茶树有寿命，无论多牛的茶树到了岁数就死掉了。这个类似于自然界给所有人都有设定寿命是一个道理。如果人永远不死，那么人类就不会发展了。类似的拟生设计在TEA Project中比比皆是。比如此前提到的席位制度也是模仿了民主国家常见的议会制度，只不过强加了一个哈伯格税来强制退位避免独裁。

# 说来说去，真的就是大富翁？非也！

看了上一个章节，真的感觉TEA Project是一个游戏了？其实完全不是。TEA Project是一个去中心化云计算平台。简单描述就是亚马逊，阿里云这样的中心化云计算平台，给他去中心化了。让茶农（或者叫矿工）提供计算能力，来运行去中心化的TEA Application，简称TApps。这些TApps是超越现有的智能合约接近于Web和移动应用体验，但仍然去中心化运行。

## 用第一性原则理解从DApps到TApps

要想理解为啥需要TApps，我们还是从第一性原则出发来进行思维演化。

让我们从DApps可以思维实验。DApps的最重要的逻辑核心是智能合约。这个大家一定都知道。那么为啥非要把逻辑写入智能合约？有什么逻辑用智能合约可以写但是用其他云计算不能写的吗？事实上作为一个专用图灵完备的状态机，所有可以在智能合约上写的逻辑都可以跑在任何云计算平台上，而且效率提高成百上千倍成本下降成百上千倍。还有开发人员的工资也便宜很多 :) 那么为啥要写成智能合约呢？对了，是因为去中心化。因为只有去中心化可以做到不受人为干预的稳定可靠运营不可篡改不可停止。那么接下来的问题就涉及到第一性原则了。是不是只有智能合约可以做到这些？如果有其他方法也可以做到不受人为干预可靠稳定运行，那岂不是就发现了一个汽车而不是跑得更快的马？

让我们继续深入我们的思维实验。为什么智能合约可以做到这些特性？是因为共识算法。通过共识算法任何小于安全边界的作恶者都无法改变运算结果，而且作恶者还会收到经济损失作为惩罚。别停，再进一步思考。如果有其他办法也能做到在一定的安全边界约束下作恶者无法改变运算结果，是不是就达到了同样的目的？没错，这个就是我们要寻找的方向。看看这个世界上是不是有太多东西是不依赖人为主观因素而改变。比如在地球表面有重力加速度，所以苹果掉下来会砸到脑袋，无论你承认不承认喜欢不喜欢。时间和熵都往一个方向前进，无论你是不是喜欢，你也没有办法回到过去。光速在我们这个时空是不变的而且是最快的速度。等等这些都是一些完全客观的物理量。我们无论是否愿意承认也无法改变。如果我们把这些物理量拿出来作为一个共识机制，让我们的代码逻辑运行在这样的环境下，岂不是就达到了智能合约的目的了吗？

没错，TEA Project的第一性原则就是这样诞生的。TEA选择了两个物理原理来作为共识基础。一个是基于半导体技术的Trusted computing，另一个是基于时间。前者用于保证代码在可以信任的环境下不受干预的执行而且可以被同类（不是人类，而是另外一些同样的可信的半导体）进行监督审计。后者用于保证所有实际发生的事件都可以全局排序从而保证全球的状态机一致同步而无需复杂的共识算法。

我承认上述两点都很底层技术，理解起来比较烧脑。显然还是游戏更加吸引人。那么我也把他们编成故事来举例就容易理解多了。

## 从验证结果到验证环境

先说第一个，什么叫做可信计算环境。如果让你做一道算术题，不是加减乘除之类幼儿园算术，稍微复杂一些的。比如带上根号取log啥的，我估计很少有人会用手写草稿纸计算了。一般来说就拿起计算器，或者电脑去计算。那么大家有多少人去验证一下这个机器会不会算错呢？应该很少。为啥？因为大家相信它。就算有人怀疑，可以多拿几台不同的设备计算一下看看结果是不是匹配，然后就相信了。好，那么就等于是说如果满足如下两个条件，我们就相信结果正确：

* 我使用一个正牌的，验证可用的计算器来进行这个计算
* 我亲自输入而且确定输入的内容正确

如果再加上一个确保的冗余验证条件： 我还在另外一个牌子的设备上重新执行过一次同样的计算，结果是一样的。所以这个结果就是正确的。

这个就是我们的可信计算环境的故事。对于一个复杂的商业逻辑来说，验证输入数据和输入代码，加上对计算环境的可信验证要比对结果验证容易很多。传统的区块链技术智能合约技术就是验证结果而不是计算环境，于是造成了运行效率低下成本高而且还不是通用计算。虽然现在有很多技术通过分片并行等方式提高智能合约的吞吐率，但也无非是跑得更快的马而已，并没有从第一性原则来根本改变，把它变成一辆车。

我们在设计TEA Project的时候考察了多种可信计算环境的方案. 最终决定首选面向未来的RISC-V芯片技术加上Trusted computing作为首选. 好处就是这样的矿机可以"异构"成为各种不同的形态而不再局限于传统意义上的机柜上的服务器. 比如你的路由器, 电视冰箱洗衣机, 你的电动汽车, 他们\]都可以成为矿机. 想象一下当你的车停在车库充电的时候顺便帮你挖矿挣钱感觉香不香?

## "偷"人造卫星的时间信号来做共识

再说第二个，什么是基于时间的共识.  对于共识这个名词无论是否从技术上完全理解了, 搞过区块链的肯定没有少听说过这个名词. PoW, POS, PoSomethingElse都是共识的类型. 我们还是从第一性原则的逻辑出发, 为什么需要这些共识, 他们是用来解决什么问题的? 简单回答, 他们就是为了让所有分布式节点对一系列事件(专业叫法是交易)的顺序达成一致意见. 一旦这个顺序达成一致了, 那么所有节点维护自己的状态机(专业说法也叫账本)就一样可以达成一致了. 这样我们就可以从任何一个节点上获得准确的状态(或者叫账本)而不会有不一致的错误. 无论是PoW还是PoS都是为了让交易顺序达成一致. 当然, 这个一致是有很高的成本的. 大家多多少少都听说过PoW消耗大量电力这个事实. 这主要是因为需要通过这样的消耗来确保作恶的高成本. 这些细节大家如果还没有看过或者看懂中本聪的比特币白皮书,一定更要去看一下. 我在这里不赘述了. 

我需要指出的还是第一性原则. 如果我们有其他方法来在所有分布式节点上达成交易顺序的一致性, 是不是就满足了共识的要求. 我们就不再需要传统的耗时耗电的共识方式了? 事实上我们的确就是这样做的.  我们的做法其实很简单, 就是寻找一个全球一致的准确稳定可靠可信的时间来源, 让所有的事件(交易)都带上这个"时间戳". 每个收到的节点都可以按照这个时间戳把混存区域的事件排序后再进行按照时间顺序处理. 这样所有的分布式节点虽然分布在世界各地, 网络延迟也不同, 只要缓冲区够大, 就可以实现无需复杂的共识算法, 只需要简单排序就可以实现全网事件顺序一致. 这就达到了共识算法的要求. 满足了第一性原则. 进而就形成了一个更加简单高效的状态机, 取代了传统的区块链共识算法.

上述方法有经验的人马上就会提出一些明显的漏洞: 我怎么知道这个时间戳不是伪造的?  我作为一个诚实节点老老实实按照时间排序, 但是我如何保证其他节点也是诚实排序而不会故意调整顺序? 问的很好, 如果没有这样的问题, 共识问题早就解决了. 那么我们如何解决这样的问题的呢? 请向上卷, 看我们此前提到的第一个问题: "什么叫可信计算环境"? 从那个问题的逻辑推理中我们已经得出了一个结论: 如果我们可以全网验证一个计算环境的可行性, 那么这个节点的计算结果就是可信的. 换言之, 这个节点没法说谎. 它发出的经过签名的事件加时间戳是诚实的, 它处理事件排序的时候也是诚实的. 如果它的代码被修改了, 那么可信执行环境就会报告并引起全网远程验证的失败, 因此会被踢出网络并承受惩罚. 

那么还有人继续追问, 那么这个验证机制和惩罚机制会不会有问题? 问的很好. 这个验证机制和惩罚机制我们使用了现有的区块链智能合约技术, 也就是我们内部说的"一层区块链". 经过十几年的运作, 区块链的安全可信已经得到公认. 所以我们用它作为我们的一层技术, 来保证验证逻辑和惩罚逻辑. 所以我们自身虽然不是区块链, 但是我们还是需要依赖一个一层区块链作为我们的一个重要的信任源. 有验证环境和奖惩需要的计算量相对处理交易而言几乎可以忽略. 所以TEA Project用来支付给一层区块链的Gas 费经过分摊之后基本上也可以忽略不计. 因此TEA Project可以实现极为高效和低成本的计算.

由于我们对一层区块链的需求仅限于验证环境逻辑和奖惩, 所以我们是"区块链无关"的. 也就是说无论是哪个区块链作为我们的一层都可以的. 我们目前已经可以用Ethereum和Polkadot作为我们的一层, 未来可以用于任何主流的区块链. 一层区块链再加上上述的可信时间戳, 以及可信计算环境, 这三个因素组成了TEA Project的三个信任根. 英文叫做 roots of trust.

基于时间戳的共识并不是我们发明的. 事实上Google 十年来一直使用一个叫做 Gogole Spanner的数据库就是使用基于时间戳的共识的. 这个数据库事实上支撑了几乎所有Google的互联网应用, 比如Google Drive, Gmail等. 作为一个中心化的系统, Google Spanner并不需要处理信任问题, 而且他们的节点是分布在世界各地的Google数据中心内部, 因此他们使用了原子钟作为事件源. 这一点是TEA Project不能学习的. 因为我们无法要求我们的矿工配置价格昂贵的原子钟. 因此我们采用了一个十分取巧的解决方案. 从GPS卫星上"偷" 时间信号!

这里也许需要做一些科普. 大家都使用手机导航. 手机之所以可以导航就是因为里面的GPS接收器芯片接受了来自天上的GPS卫星发出的时间信号. 根据光速不变原理来计算你这台手机相对于已知运行轨道的GPS卫星的距离. 根据这个距离来计算你在地球上的位置. 所以所以GPS卫星上发出的信号实际上就是十分精确的时间信息. 因为接受GPS广播的时间信息是免费而且是高度精确的, 用作每个矿机的时间源再合适不过了.

# 安全边界

上一个话题十分硬核烧脑. 我相信有不少冲着游戏话题来的人中途已经走人继续玩游戏去了. 如果你还在继续阅读, 那么说明你已经通过烧脑测试了. 我们继续讨论更硬核的内容. 好消息是本文不是核心技术论文而是科普性质的, 点到即止. 差不多也就深入到这个程度了, 往后的话题就轻松很多了. 请再坚持一下.

这个话题是安全边界. 没有任何一个系统是100%安全的. 都有一个安全边界的存在. 比特币的PoW是51%攻击, 拜占庭容错是2/3 好节点假设. TEA Project也存在这类安全边界. 

因为TEA依赖于外部的时间信号作为共识依据. 所以第一个最容易被攻击地方就是GPS无线电信号. 对于单个节点和位于某一个被攻击地区的节点而言, 这个攻击类似于DDoS是无法解决的. 所以我们的安全边界是这些受攻击的节点少于1/3. 而且为了增加容错, 我们对于时间信号也有额外的校验和抛弃策略, 而且未来的硬件会要求兼容除了GPS之外的其他卫星的时间信号从而提高生存率.

第二个难度比较大的攻击来自于硬件芯片的生产环节. 虽然硬件是开源, 但是毕竟生产环节还是相对中心化的. 从恶人角度出发不可能完全避免在巨大利益趋势下芯片制造环节被认为加入后门代码. 解决这个问题一方面是通过引入竞争机制和形式化验证成品硬件. 另一方面就是经济学设计中的"计划生育"策略. 简言之就是通过CML代币的价格来控制各种硬件平台和软件平台组合的比例,试图保证各种多样性的平衡. 这个很接近于生物多样性原理. 这样任何一种单一的软硬件组合在整体节点数量中都不会占据绝对优势. 即使日后后门被黑客激活, 只要不超过1/3的影响率, 都不会造成决定性影响. 

第三个我们认为很低的概率就是我们依赖的一层区块链被严重攻击. 这种攻击我们可以分两种情况. 第一种是遭受攻击出块缓慢但是仍然可以工作. 这样的时候由于我们对一层的依赖只限于安全认证和奖惩, 并不是实时任务. 对及时性的容错度还是很高的. 不会有太大影响. 第二种就是这个一层区块链完全停止了. 虽然可能性极低, 我们的预防策略就是依赖多条主流一层区块链作为主备. 只要不是这些区块链同时遭受攻击同时失效, 我们作为上层仍然可以照常运作. 

上述三个情况已经涵盖了我们所有三个信任根都出问题的情况. 下面集中讨论涉及经济学和过渡阶段的问题.

TEA Project是一个由服务提供者(矿工或者茶农)和持币人组成的DAO. 有人的地方就有江湖. 重要的DAO决策都需要通过设定好的投票规则通过民主决策来完成. 因为不同集团有不同的利益. 简单的按照节点数量加权投票或者按照持币数量加权投票都可能会破坏利益平衡. 所以在DAO管理这方面我们在考虑引入Reputation机制. 使用算法来控制reputation代币的获取, 从而平衡各方利益, 使得TEA Project的可持续性发展. 包括二次方投票等思路都在考虑中.

以上的很多假设都是社区足够成熟, 节点够多, 经济体已经正常运行的前提下达成的. 实际上在项目启动初期, 这些条件尚不具备. 通常情况下, 在这样一个临时过渡期项目团队需要有更大的担当来控制更多的集中权利. 尤其是在软硬件系统升级维护方面, 项目推广资金使用方面, 通过开发团队快速决策执行是必要的. 因此我们目前计划是在主网上线起两年的时间作为过渡期. 随后的各种DAO制度在这个期间逐步完善过渡到完全自动化运行.

# 如何挣TEA?
